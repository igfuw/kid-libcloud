diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/namelists/SC_2D_input.nml kid_a_setup/namelists/SC_2D_input.nml
--- kid_a_setup.orig/namelists/SC_2D_input.nml	2014-07-23 17:16:13.000000000 +0200
+++ kid_a_setup/namelists/SC_2D_input.nml	2014-11-24 12:52:23.968646937 +0100
@@ -3,6 +3,6 @@
 ! comment out this call (in namelists.nml) and use this file to input
 ! the value.
 &namelistToUse
-fileIn='namelists/SC_2D.nml'
+fileIn='namelists/kida_SC_2D_libcloud_lgr.nml'
 fileOut='output/SC_2D_out.nc'
 /
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/compiler_options.inc kid_a_setup/src/compiler_options.inc
--- kid_a_setup.orig/src/compiler_options.inc	2014-07-25 10:17:28.000000000 +0200
+++ kid_a_setup/src/compiler_options.inc	2014-11-24 12:52:23.968646937 +0100
@@ -53,10 +53,11 @@
 LD=$(F90)   # Linker
 
 INCDF=-I$(NCPATH)/include
-LNCDF=-L$(NCPATH)/lib -lnetcdf
+LNCDF=-L$(NCPATH)/lib -lnetcdff
 LDFLAGS=$(INCDF) $(LNCDF)
 
 EXECUTABLE=$(MODEL)_$(CASE).exe
+SHARED_LIB=$(MODEL)_$(CASE).so
 
 F2PY=/usr/local/cdat/bin/f2py 
 F2PY_OPTS=--fcompiler-exec=$(COMPILER) $(LDFLAGS) 
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/defines.inc kid_a_setup/src/defines.inc
--- kid_a_setup.orig/src/defines.inc	2014-07-25 10:17:28.000000000 +0200
+++ kid_a_setup/src/defines.inc	2014-11-24 12:52:23.972646937 +0100
@@ -19,8 +19,8 @@
 endif
 
 ifeq ($(CASE), SC_2D)
-D1=DEF_NX=100
-D2=DEF_NZ=52
+D1=DEF_NX=3
+D2=DEF_NZ=6
 endif
 
 ifeq ($(CASE), CU_2D)
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/diagnostics.f90 kid_a_setup/src/diagnostics.f90
--- kid_a_setup.orig/src/diagnostics.f90	2014-07-25 10:17:28.000000000 +0200
+++ kid_a_setup/src/diagnostics.f90	2014-12-09 17:52:56.979349155 +0100
@@ -21,6 +21,8 @@
 
   Use namelists, only: KiD_outdir, KiD_outfile, fileNameOut
 
+  use iso_c_binding, only: c_int, c_float, c_char
+
   Implicit none
 
   type, public :: dgID
@@ -1132,6 +1134,21 @@
 
   end subroutine save_dg_1d_point_sp
 
+
+  subroutine save_dg_2d_sp_c( &
+    field, nx, nz,            & 
+    name, namelen,            &
+    units, unitslen,          &
+    itime                     &
+  )
+    integer(c_int), intent(in), value :: nx, nz, itime, namelen, unitslen
+    real(c_float), intent(in) :: field(nz, nx)
+    character(namelen) :: name
+    character(unitslen) :: units
+    
+    call save_dg_2d_sp(field, name, itime, units, "z,x")
+  end subroutine
+
   subroutine save_dg_2d_sp(field, name, itime, units, &
        dim, longname)
 
@@ -1718,6 +1735,20 @@
     
   end subroutine save_dg_bin_dp
 
+  subroutine save_dg_2d_bin_sp_c( &
+    field, nb, nx, nz,            & 
+    name, namelen,                &
+    units, unitslen,              &
+    itime                         &
+  )
+    integer(c_int), intent(in), value :: nb, nx, nz, itime, namelen, unitslen
+    real(c_float), intent(in) :: field(nz, nx, nb)
+    character(namelen) :: name
+    character(unitslen) :: units
+    
+    call save_dg_2d_bin_sp(field, name, itime, units, "z,x,b")
+  end subroutine
+
 subroutine save_dg_2d_bin_sp(field, name, itime, units, &
      dim, longname)
     
@@ -1826,6 +1857,19 @@
     
   end subroutine save_dg_2d_bin_dp
 
+  subroutine save_binData_sp_c(&
+    field, nb,                 & 
+    name, namelen,             &
+    units, unitslen            &
+  )
+    integer(c_int), intent(in), value :: nb, namelen, unitslen
+    real(c_float), intent(in) :: field(nb)
+    character(namelen) :: name
+    character(unitslen) :: units
+    
+    call save_binData_sp(field, name, units)
+  end subroutine
+
   subroutine save_binData_sp(field, name, units, &
        longname)
     ! Save the bin data (e.g. sizes or masses)
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/makefile.inc kid_a_setup/src/makefile.inc
--- kid_a_setup.orig/src/makefile.inc	2014-07-25 10:17:28.000000000 +0200
+++ kid_a_setup/src/makefile.inc	2014-12-09 16:44:09.923562471 +0100
@@ -29,7 +29,7 @@
 OBJS=$(OBJSF) $(OBJSF90)
 
 
-all: defs $(EXECUTABLE)
+all: defs $(SHARED_LIB)
 
 defs:
 	touch case.used
@@ -49,10 +49,13 @@
 	$(F90D) -c $< -o $@ $(INCDF)
 
 $(OBJSF90): $(OBJDIR)/%.o: %.f90 
-	$(F90D) -c $< -o $@ $(INCDF)
+	$(F90D) -c -fPIC $< -o $@ $(INCDF)
 
 $(OBJSF): $(OBJDIR)/%.o: %.f 
-	$(F90D)  -c $< -o $@ $(INCDF)
+	$(F90D) -c -fPIC $< -o $@ $(INCDF)
 
 $(EXECUTABLE): $(OBJS) $(OBJSF90_UM) $(OBJSF90_4A)
 	$(LD) -o $(EXECDIR)/$(EXECUTABLE) $(OBJDIR)/*.o $(OBJSF90_4A) $(OBJSF90_UM) $(LDFLAGS)
+
+$(SHARED_LIB): $(OBJS) $(OBJPTRUTIL) $(OBJSF90_UM) $(OBJSF90_4A)
+	$(LD) -shared -o $(EXECDIR)/$(SHARED_LIB) $(OBJDIR)/*.o $(OBJSF90_4A) $(OBJSF90_UM) $(LDFLAGS)
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/mphys_interface.f90 kid_a_setup/src/mphys_interface.f90
--- kid_a_setup.orig/src/mphys_interface.f90	2014-07-25 10:17:27.000000000 +0200
+++ kid_a_setup/src/mphys_interface.f90	2014-11-24 12:52:23.972646937 +0100
@@ -19,6 +19,7 @@
 #if SHIPWAY_MICRO == 1
   Use mphys_4A, only: mphys_4A_interface
 #endif
+  Use mphys_libcloud_lgr, only: mphys_libcloud_lgr_interface
   Use switches
 
 contains
@@ -44,6 +45,9 @@
     case(imphys_4A)         ! Shipway 4A scheme
        call mphys_4A_interface
 #endif
+    case(imphys_libcloud_lgr) ! libcloudph++: lagrangian scheme (super-droplet)
+       call mphys_libcloud_lgr_interface
+
     end select
 
   end subroutine mphys_column
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/namelists.f90 kid_a_setup/src/namelists.f90
--- kid_a_setup.orig/src/namelists.f90	2014-07-25 10:17:28.000000000 +0200
+++ kid_a_setup/src/namelists.f90	2014-11-24 12:52:23.972646937 +0100
@@ -173,6 +173,11 @@
     case('4A')
        imphys=imphys_4A
        mphys_id='4A'
+    case('libcloud_lgr')
+       imphys=imphys_libcloud_lgr
+       mphys_id='libcloud_lgr'
+
+
      case default
        print*, 'Mphys scheme not recognized: ', mphys_scheme
        print*, 'Did you mean:' 
diff -ruN '--exclude=mphys_libcloud_lgr.f90' '--exclude=kida_SC_2D_libcloud_lgr.nml' '--exclude=*~' '--exclude=*.mod' '--exclude=*.o' '--exclude=bin' '--exclude=4A_code' '--exclude=UM_source' '--exclude=.includes' '--exclude=case.used' '--exclude=output' '--exclude=gmon.out' kid_a_setup.orig/src/switches.f90 kid_a_setup/src/switches.f90
--- kid_a_setup.orig/src/switches.f90	2014-07-25 10:17:28.000000000 +0200
+++ kid_a_setup/src/switches.f90	2014-11-24 12:52:23.972646937 +0100
@@ -96,7 +96,8 @@
        ,imphys_um7_3            =9  & ! UM test: Jonathan Wilkinson
        ,imphys_wsm6             =10 & ! WSM6 scheme
        ,imphys_wdm6             =11 & ! WDM6 scheme
-       ,imphys_4A               =12   ! Shipway scheme
+       ,imphys_4A               =12 & ! Shipway scheme
+       ,imphys_libcloud_lgr     =44   ! libcloudph++: lagrangian scheme (super-droplet)
       
   ! Integer switches to choose input data type and/or test case
   integer, parameter ::    & 
